<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Generator - Vinayaka Industries</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="invoiceApp" class="max-w-4xl mx-auto my-10 p-6 bg-white shadow-lg rounded-lg">
    <h1 class="text-3xl font-bold mb-6">Invoice Generator</h1>

    <!-- Form Section -->
    <div id="invoiceForm" class="space-y-6">
      <!-- Customer -->
      <div>
        <label class="block font-semibold mb-2" for="customerSelect">Customer</label>
        <select id="customerSelect" class="w-full border rounded p-2">
          <option value="">-- Select Customer --</option>
        </select>
      </div>
      <!-- Items -->
      <div>
        <label class="block font-semibold mb-2">Items</label>
        <table class="w-full border-collapse text-sm">
          <thead>
            <tr class="bg-gray-200">
              <th class="border p-2">Sr.No.</th>
              <th class="border p-2">Item</th>
              <th class="border p-2">HSN/SAC</th>
              <th class="border p-2">Rate</th>
              <th class="border p-2">Qty</th>
              <th class="border p-2">IGST%</th>
              <th class="border p-2">Amount</th>
              <th class="border p-2">Remove</th>
            </tr>
          </thead>
          <tbody id="itemsTable"></tbody>
        </table>
        <button id="addItemBtn" class="mt-3 bg-blue-600 text-white px-4 py-2 rounded">Add Item</button>
      </div>
      <!-- Actions -->
      <div class="flex gap-4">
        <button id="saveInvoiceBtn" class="flex-1 bg-green-600 text-white px-4 py-2 rounded">Save & Generate PDF</button>
        <button id="resetBtn" class="flex-1 bg-gray-500 text-white px-4 py-2 rounded">Reset</button>
      </div>
    </div>

    <!-- Preview Section -->
    <div id="invoicePreview" class="mt-10 p-6 bg-white border rounded shadow-inner">
      <!-- Header -->
      <div class="flex justify-between items-center mb-6">
        <div>
          <img src="https://drive.google.com/thumbnail?id=1L_NG4hUWi56GAaSTWBYFyau5cpG2Pb7W&sz=s800" alt="Logo" class="h-16">
        </div>
        <div class="text-right">
          <h2 class="text-2xl font-bold">VINAYAKA INDUSTRIES</h2>
          <p>No.34, Lakshmipura Main Road</p>
          <p>Chikkabanavara Post, Abigere, Bangalore - 560090</p>
          <p>Mo: +91 9448355315</p>
        </div>
      </div>
      <!-- Meta -->
      <div class="grid grid-cols-2 gap-4 mb-6 text-sm">
        <div class="space-y-1">
          <p><span class="font-semibold">Debit Memo / Tax Invoice</span></p>
          <p><span class="font-semibold">M/s:</span> <span id="previewCustomer"></span></p>
          <p><span class="font-semibold">Place of Supply:</span> <span id="previewPlace"></span></p>
          <p><span class="font-semibold">GSTIN:</span> 21AQCPK0903A1ZI</p>
        </div>
        <div class="text-right space-y-1">
          <p><span class="font-semibold">Invoice No:</span> <span id="previewInvoiceNo"></span></p>
          <p><span class="font-semibold">Date:</span> <span id="previewDate"></span></p>
          <p><span class="font-semibold">Delivery:</span> <span id="previewDelivery"></span></p>
        </div>
      </div>
      <!-- Items Table -->
      <table class="w-full border-collapse text-sm mb-4">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Sr.No.</th>
            <th class="border p-2">Product name</th>
            <th class="border p-2">HSN/SAC</th>
            <th class="border p-2">Qty</th>
            <th class="border p-2">Rate</th>
            <th class="border p-2">IGST%</th>
            <th class="border p-2">Amount</th>
          </tr>
        </thead>
        <tbody id="previewItems"></tbody>
      </table>
      <!-- Totals and Notes -->
      <div class="flex justify-between text-sm">
        <div class="w-1/2">
          <p><span class="font-semibold">GSTIN:</span> 21AQCPK0903A1ZI</p>
          <p class="mt-4 font-semibold">Note:</p>
          <ul class="list-disc list-inside">
            <li>Goods once sold will not be taken back.</li>
            <li>Interest @18% p.a. if payment delayed.</li>
            <li>Our risk & responsibility ceases once goods leave premises.</li>
          </ul>
        </div>
        <div class="w-1/2">
          <table class="w-full text-right text-sm">
            <tr>
              <td class="py-1">Sub Total</td>
              <td class="py-1">₹<span id="previewSubtotal"></span></td>
            </tr>
            <tr>
              <td class="py-1">Total GST</td>
              <td class="py-1">₹<span id="previewTotalGST"></span></td>
            </tr>
            <tr>
              <td class="py-1">Round Off</td>
              <td class="py-1">₹<span id="previewRoundOff"></span></td>
            </tr>
            <tr class="font-bold bg-gray-100">
              <td class="py-1">Grand Total</td>
              <td class="py-1">₹<span id="previewGrandTotal"></span></td>
            </tr>
          </table>
          <div class="mt-8 text-right">
            <p>For VINAYAKA INDUSTRIES</p>
            <p class="mt-12">(Authorised Signature)</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // CSV URLs
    const CUSTOMER_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFxJyIv-_4zkNDXwmv5gWE-LRybVLKayk8jmiUCdbuL1XX4Ac0DuU5ip1jZmo-GaDQwWUhJFw8Pt/pub?output=csv&gid=770007065';
    const PRODUCT_CSV  = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFxJyIv-_4zkNDXwmv5gWE-LRybVLKayk8jmiUCdbuL1XX4Ac0DuU5ip1jZmo-GaDQwWUhJFw8Pt/pub?output=csv&gid=0';
    const HISTORY_URL  = 'https://script.google.com/macros/s/AKfycbwDzGBCoy0NrsZggZVP_6C6qsUFCdKPj3wtjeVY12ATFIFBeIpHj9sbqNHdF7d1ZKyM/exec';

    let customers = [], products = [], items = [];

    function init() {
      Papa.parse(CUSTOMER_CSV, { download:true, header:true, complete: r => {
        customers = r.data.filter(c=>c.Name);
        const sel = document.getElementById('customerSelect');
        customers.forEach(c=> sel.appendChild(new Option(c.Name,c.Name)));
      }});
      Papa.parse(PRODUCT_CSV, { download:true, header:true, complete: r => products = r.data.filter(p=>p['Item Name']) });

      document.getElementById('customerSelect').addEventListener('change', onCustomer);
      document.getElementById('addItemBtn').addEventListener('click', addItemRow);
      document.getElementById('saveInvoiceBtn').addEventListener('click', saveAndPDF);
      document.getElementById('resetBtn').addEventListener('click', resetForm);
    }

    function onCustomer() {
      const c = customers.find(x=>x.Name===this.value);
      document.getElementById('previewCustomer').textContent = c.Name;
      document.getElementById('previewPlace').textContent = c.State;
    }

    function addItemRow() {
      const idx = items.length+1;
      items.push({});
      renderFormItems();
      renderPreviewItems();
    }

    function renderFormItems(){ /* similar dynamic rows... */ }
    function renderPreviewItems(){ /* reflect items in preview table */ }

    function calculateTotals(){ /* compute subtotal, GST, roundoff, grand total */ }

    function saveAndPDF(){
      const invoiceData = { customer:document.getElementById('customerSelect').value, items };
      fetch(HISTORY_URL+'?action=save&data='+encodeURIComponent(JSON.stringify(invoiceData)));
      html2pdf().from(document.getElementById('invoicePreview')).save();
    }

    function resetForm(){ location.reload(); }

    window.onload = init;
  </script>
</body>
</html>
