<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Invoice Generator Pro - Vinayaka Industries</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

:root {
    --primary-rgb: 56 189 248;
    --primary-dark-rgb: 37 99 235;
    --bg-light: 241 245 249;
    --text-light: 15 23 42;
    --card-bg-light: rgba(255, 255, 255, 0.5);
    --card-border-light: rgba(var(--primary-rgb), 0.3);
    --input-bg-light: rgba(255, 255, 255, 0.8);
    --input-border-light: rgba(var(--primary-rgb), 0.4);
    --text-muted-light: 100 116 139;
    --invoice-bg-light: white;
    --bg-dark: #0f172a;
    --text-dark: #f8fafc;
    --card-bg-dark: rgba(30, 41, 59, 0.3);
    --card-border-dark: rgba(var(--primary-rgb), 0.3);
    --input-bg-dark: rgba(51, 65, 85, 0.5);
    --input-border-dark: rgba(var(--primary-rgb), 0.4);
    --text-muted-dark: #94a3b8;
    --invoice-bg-dark: #1e293b;
}

* {
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    transition: background-color 0.5s ease, color 0.5s ease;
    overflow: hidden;
}

body.light-theme {
    background-color: rgb(var(--bg-light));
    color: rgb(var(--text-light));
}
body.dark-theme {
    background-color: var(--bg-dark);
    color: var(--text-dark);
}

.main-layout {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 16rem;
    height: 100vh;
    flex-shrink: 0;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 1.5rem 1rem;
    overflow-y: auto;
    transition: background-color 0.5s ease, border-color 0.5s ease;
    display: flex;
    flex-direction: column;
}
body.light-theme .sidebar {
    background-color: var(--card-bg-light);
    border-right: 1px solid var(--card-border-light);
}
body.dark-theme .sidebar {
    background-color: var(--card-bg-dark);
    border-right: 1px solid var(--card-border-dark);
}

.main-content {
    flex-grow: 1;
    padding: 2rem;
    padding-bottom: 100px;
    overflow-y: auto;
}

.glass-card {
    border-radius: 20px;
    padding: 1.5rem;
    border: 1px solid;
    box-shadow: 0 8px 32px rgba(var(--primary-rgb), 0.1);
    transition: background-color 0.5s ease, border-color 0.5s ease, transform 0.3s ease;
}
.glass-card:hover {
    transform: translateY(-5px);
}
body.light-theme .glass-card {
    background-color: var(--card-bg-light);
    border-color: var(--card-border-light);
}
body.dark-theme .glass-card {
    background-color: var(--card-bg-dark);
    border-color: var(--card-border-dark);
}

.futuristic-input,
.futuristic-select,
.futuristic-textarea {
    border: 2px solid;
    border-radius: 12px;
    padding: 12px 16px;
    transition: all 0.3s ease;
    font-weight: 500;
    width: 100%;
    outline: none;
}
body.light-theme .futuristic-input,
body.light-theme .futuristic-select,
body.light-theme .futuristic-textarea {
    background-color: var(--input-bg-light);
    border-color: var(--input-border-light);
    color: var(--text-light);
}
body.dark-theme .futuristic-input,
body.dark-theme .futuristic-select,
body.dark-theme .futuristic-textarea {
    background-color: var(--input-bg-dark);
    border-color: var(--input-border-dark);
    color: var(--text-dark);
}
.futuristic-input:focus,
.futuristic-select:focus,
.futuristic-textarea:focus {
    border-color: rgb(var(--primary-rgb));
    box-shadow: 0 0 0 4px rgba(var(--primary-rgb), 0.2);
}

.futuristic-btn {
    background: linear-gradient(
        135deg,
        rgb(var(--primary-rgb)) 0%,
        rgb(var(--primary-dark-rgb)) 100%
    );
    border: none;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    padding: 12px 24px;
    transition: all 0.3s ease;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}
.futuristic-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(var(--primary-rgb), 0.25);
}
.futuristic-btn-secondary {
    background: linear-gradient(135deg, #34d399 0%, #059669 100%);
}
.futuristic-btn-secondary:hover {
    box-shadow: 0 10px 20px rgba(52, 211, 153, 0.25);
}
.futuristic-btn-tertiary {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}
.futuristic-btn-tertiary:hover {
    box-shadow: 0 10px 20px rgba(245, 158, 11, 0.25);
}
.futuristic-btn-neutral {
    background: linear-gradient(135deg, #64748b 0%, #334155 100%);
}
.futuristic-btn-neutral:hover {
    box-shadow: 0 10px 20px rgba(100, 116, 139, 0.25);
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 12px;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
}
.nav-item.active {
    background: linear-gradient(
        135deg,
        rgb(var(--primary-rgb)) 0%,
        rgb(var(--primary-dark-rgb)) 100%
    );
    color: white;
    box-shadow: 0 6px 20px rgba(var(--primary-rgb), 0.3);
    transform: translateY(-2px);
}
.nav-item:not(.active):hover {
    background-color: rgba(var(--primary-rgb), 0.1);
    transform: translateX(5px);
}
body.light-theme .nav-item:not(.active) {
    color: #334155;
}
body.dark-theme .nav-item:not(.active) {
    color: var(--text-dark);
}

.text-muted {
    color: var(--text-muted-dark);
}
body.light-theme .text-muted {
    color: var(--text-muted-light);
}
body.light-theme .text-gray-800 {
    color: #1f2937;
}
body.dark-theme .text-gray-800 {
    color: var(--text-dark);
}

.table-header {
    border-bottom: 2px solid;
}
.table-row {
    border-bottom: 1px solid;
}
body.light-theme .table-header,
body.light-theme .table-row {
    border-color: var(--card-border-light);
}
body.dark-theme .table-header,
body.dark-theme .table-row {
    border-color: var(--card-border-dark);
}
body.light-theme .table-header {
    background-color: rgba(var(--primary-rgb), 0.05);
}
body.dark-theme .table-header {
    background-color: rgba(var(--primary-rgb), 0.1);
}

.invoice-preview {
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
    transition: background-color 0.5s ease, color 0.5s ease;
}
body.light-theme .invoice-preview {
    background-color: var(--invoice-bg-light);
    color: var(--text-light);
}
body.dark-theme .invoice-preview {
    background-color: var(--invoice-bg-dark);
    color: var(--text-dark);
}

.fixed-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem 2rem;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    z-index: 100;
}
body.light-theme .fixed-footer {
    background-color: var(--card-bg-light);
    border-top: 1px solid var(--card-border-light);
}
body.dark-theme .fixed-footer {
    background-color: var(--card-bg-dark);
    border-top: 1px solid var(--card-border-dark);
}

::-webkit-scrollbar {
    width: 8px;
}
::-webkit-scrollbar-track {
    background: transparent;
}
::-webkit-scrollbar-thumb {
    background: rgb(var(--primary-rgb));
    border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
    background: rgb(var(--primary-dark-rgb));
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.fade-in-up {
    animation: fadeInUp 0.5s ease-out forwards;
}

@media print {
    .no-print {
        display: none !important;
    }
    .sidebar,
    .main-content > .flex.justify-between,
    .fixed-footer {
        display: none !important;
    }
    .main-layout {
        display: block;
    }
    .main-content {
        padding: 0;
        overflow: visible;
    }
    .invoice-preview-container {
        border: none !important;
    }
    .invoice-preview {
        box-shadow: none;
        margin: 0;
        padding: 0;
    }
    body {
        background-color: white !important;
        color: black !important;
    }
    .invoice-preview {
        background-color: white !important;
        color: black !important;
    }
    .invoice-preview *,
    .invoice-preview .text-gray-800 {
        color: black !important;
    }
}
</style>
</head>

<body class="dark-theme">
    <div class="main-layout">
        <aside class="sidebar no-print">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-3">
                    <div
                        class="bg-gradient-to-br from-blue-500 to-blue-700 p-2 rounded-lg shadow-lg"
                    >
                        <i data-lucide="file-text" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg tracking-wider">VINAYAKA</h1>
                        <p class="text-xs text-muted">INDUSTRIES</p>
                    </div>
                </div>
                <button
                    id="theme-toggle"
                    class="p-2 rounded-full transition-colors duration-300 hover:bg-black/10 dark:hover:bg-white/10"
                >
                    <i
                        id="theme-icon"
                        data-lucide="sun"
                        class="w-5 h-5 text-muted"
                    ></i>
                </button>
            </div>

            <nav class="flex-grow">
                <ul class="space-y-2">
                    <li>
                        <a href="#dashboard" class="nav-item active"
                            ><i data-lucide="layout-dashboard" class="w-5 h-5"></i
                            ><span>Dashboard</span></a
                        >
                    </li>
                    <li>
                        <a href="#create-invoice" class="nav-item"
                            ><i data-lucide="file-plus" class="w-5 h-5"></i
                            ><span>Create Invoice</span></a
                        >
                    </li>
                    <li>
                        <a href="#quotation" class="nav-item"
                            ><i data-lucide="file-check-2" class="w-5 h-5"></i
                            ><span>Quotation</span></a
                        >
                    </li>
                    <li>
                        <a href="#invoice-history" class="nav-item"
                            ><i data-lucide="history" class="w-5 h-5"></i
                            ><span>History</span></a
                        >
                    </li>
                    <li>
                        <a href="#customers" class="nav-item"
                            ><i data-lucide="users" class="w-5 h-5"></i
                            ><span>Customers</span></a
                        >
                    </li>
                    <li>
                        <a href="#products" class="nav-item"
                            ><i data-lucide="package" class="w-5 h-5"></i
                            ><span>Products</span></a
                        >
                    </li>
                    <li>
                        <a href="#reports" class="nav-item"
                            ><i data-lucide="bar-chart-3" class="w-5 h-5"></i
                            ><span>Reports</span></a
                        >
                    </li>
                </ul>
            </nav>
            <div>
                <a href="#settings" class="nav-item"
                    ><i data-lucide="settings" class="w-5 h-5"></i><span
                        >Settings</span
                    ></a
                >
            </div>
        </aside>

        <main class="main-content">
            <!-- DASHBOARD PAGE -->
            <div id="dashboard" class="page">
                <div
                    class="flex justify-between items-center mb-8 fade-in-up"
                    style="animation-delay: 100ms"
                >
                    <div>
                        <h2 class="text-3xl font-bold">Invoice Generator Pro</h2>
                        <p class="text-muted">Create professional invoices with GST compliance</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span
                            class="bg-green-500/20 text-green-400 text-xs font-semibold px-3 py-1 rounded-full flex items-center"
                        >
                            <div
                                class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"
                            ></div>GST Ready
                        </span>
                        <button
                            onclick="syncData()"
                            class="futuristic-btn futuristic-btn-neutral"
                        >
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i
                            ><span>Sync</span>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div
                        class="glass-card p-6 fade-in-up"
                        style="animation-delay: 200ms"
                    >
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-muted text-sm">TOTAL INVOICES</p>
                                <p
                                    class="text-3xl font-bold"
                                    id="stats-total-invoices"
                                >
                                    0
                                </p>
                            </div>
                            <div class="bg-blue-500/20 p-3 rounded-lg">
                                <i data-lucide="file-text" class="text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                    <div
                        class="glass-card p-6 fade-in-up"
                        style="animation-delay: 300ms"
                    >
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-muted text-sm">REVENUE</p>
                                <p class="text-3xl font-bold" id="stats-revenue">₹0</p>
                            </div>
                            <div class="bg-green-500/20 p-3 rounded-lg">
                                <i data-lucide="dollar-sign" class="text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    <div
                        class="glass-card p-6 fade-in-up"
                        style="animation-delay: 400ms"
                    >
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-muted text-sm">ACTIVE CUSTOMERS</p>
                                <p
                                    class="text-3xl font-bold"
                                    id="stats-active-customers"
                                >
                                    0
                                </p>
                            </div>
                            <div class="bg-yellow-500/20 p-3 rounded-lg">
                                <i data-lucide="users" class="text-yellow-400"></i>
                            </div>
                        </div>
                    </div>
                    <div
                        class="glass-card p-6 fade-in-up"
                        style="animation-delay: 500ms"
                    >
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-muted text-sm">PRODUCTS</p>
                                <p class="text-3xl font-bold" id="stats-products">0</p>
                            </div>
                            <div class="bg-purple-500/20 p-3 rounded-lg">
                                <i data-lucide="package" class="text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="glass-card p-6 fade-in-up"
                    style="animation-delay: 600ms"
                >
                    <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <a
                            href="#create-invoice"
                            class="nav-link-action futuristic-btn p-6 rounded-lg flex flex-col items-start justify-between text-left h-40"
                        >
                            <i data-lucide="file-plus" class="w-8 h-8 mb-4"></i>
                            <div>
                                <p class="font-bold text-lg">Create Invoice</p>
                                <p class="text-sm font-normal text-white/70">
                                    Generate GST invoice
                                </p>
                            </div>
                        </a>
                        <a
                            href="#customers"
                            class="nav-link-action futuristic-btn futuristic-btn-secondary p-6 rounded-lg flex flex-col items-start justify-between text-left h-40"
                        >
                            <i data-lucide="user-plus" class="w-8 h-8 mb-4"></i>
                            <div>
                                <p class="font-bold text-lg">Add Customer</p>
                                <p class="text-sm font-normal text-white/70">
                                    Register new customer
                                </p>
                            </div>
                        </a>
                        <a
                            href="#products"
                            class="nav-link-action futuristic-btn futuristic-btn-tertiary p-6 rounded-lg flex flex-col items-start justify-between text-left h-40"
                        >
                            <i data-lucide="package-plus" class="w-8 h-8 mb-4"></i>
                            <div>
                                <p class="font-bold text-lg">Add Product</p>
                                <p class="text-sm font-normal text-white/70">
                                    Manage inventory
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- CREATE INVOICE PAGE -->
            <div id="create-invoice" class="page hidden">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold">Create Invoice</h2>
                        <p class="text-muted">Generate GST compliant invoices</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="glass-card p-8">
                        <h3 class="text-xl font-bold mb-6">Invoice Details</h3>
                        <form id="invoice-form" class="space-y-4" autocomplete="off">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >Invoice Number</label
                                    >
                                    <div class="relative">
                                        <input
                                            id="invoice-number"
                                            type="text"
                                            class="futuristic-input pr-10"
                                            readonly
                                            autocomplete="off"
                                        />
                                        <button
                                            type="button"
                                            onclick="refreshInvoiceNumber()"
                                            class="absolute inset-y-0 right-0 flex items-center pr-3 text-muted hover:text-blue-400 transition-colors"
                                            title="Refresh Invoice Number"
                                        >
                                            <i
                                                data-lucide="refresh-cw"
                                                class="w-5 h-5"
                                            ></i>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >Invoice Date</label
                                    >
                                    <input
                                        id="invoice-date"
                                        type="date"
                                        class="futuristic-input"
                                        required
                                        autocomplete="off"
                                    />
                                </div>
                            </div>

                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Select Customer</label
                                >
                                <select
                                    id="customer-select"
                                    class="futuristic-select"
                                    required
                                ></select>
                            </div>

                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Customer GSTIN</label
                                >
                                <input
                                    id="customer-gstin-display"
                                    type="text"
                                    class="futuristic-input bg-opacity-50"
                                    readonly
                                    autocomplete="off"
                                />
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >Place of Supply</label
                                    >
                                    <input
                                        id="place-of-supply-display"
                                        type="text"
                                        class="futuristic-input bg-opacity-50"
                                        readonly
                                        autocomplete="off"
                                    />
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >Dispatch</label
                                    >
                                    <select
                                        id="dispatch-method"
                                        class="futuristic-select"
                                        autocomplete="off"
                                    >
                                        <option>By Transport</option>
                                        <option>By Self</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Eway Bill #</label
                                >
                                <input
                                    id="eway-bill-number"
                                    type="text"
                                    class="futuristic-input"
                                    placeholder="Enter E-Way Bill Number if applicable"
                                    autocomplete="off"
                                />
                            </div>
                        </form>

                        <div class="mt-8">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold">Invoice Items</h3>
                                <button
                                    onclick="addInvoiceItem()"
                                    class="futuristic-btn futuristic-btn-secondary px-4 py-2"
                                >
                                    <i data-lucide="plus" class="w-4 h-4"></i
                                    ><span>Add Item</span>
                                </button>
                            </div>
                            <div
                                id="invoice-items-container"
                                class="space-y-4 max-h-[50vh] overflow-y-auto p-1"
                            ></div>
                        </div>
                    </div>

                    <div class="p-2 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold">Live Preview</h3>
                            <button
                                onclick="resetInvoiceForm()"
                                class="text-sm futuristic-btn futuristic-btn-neutral px-3 py-1"
                            >
                                <i data-lucide="rotate-cw" class="w-4 h-4"></i
                                ><span>Reset</span>
                            </button>
                        </div>
                        <div
                            id="invoice-preview-container"
                            class="border-2 border-dashed border-white/20 rounded-lg overflow-hidden"
                        >
                            <div id="invoice-preview" class="invoice-preview">
                                <div
                                    class="flex flex-col justify-center items-center text-center text-muted h-full p-6"
                                >
                                    <i
                                        data-lucide="file-text"
                                        class="w-16 h-16 mx-auto mb-4 opacity-50"
                                    ></i>
                                    <p>Invoice preview will appear here</p>
                                    <p class="text-sm">
                                        Fill in the invoice details to see the live
                                        preview
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INVOICE HISTORY PAGE -->
            <div id="invoice-history" class="page hidden">
                <div
                    class="flex justify-between items-center mb-8"
                >
                    <div>
                        <h2 class="text-3xl font-bold">History</h2>
                        <p class="text-muted">View and manage all documents</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="history-toggle" class="flex rounded-lg bg-slate-700 p-1">
                            <button
                                class="px-4 py-1 text-sm rounded-md"
                                data-type="invoices"
                            >
                                Invoices
                            </button>
                            <button
                                class="px-4 py-1 text-sm rounded-md"
                                data-type="quotations"
                            >
                                Quotations
                            </button>
                        </div>
                        <button
                            onclick="syncData()"
                            class="futuristic-btn futuristic-btn-neutral"
                        >
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i
                            ><span>Load Data</span>
                        </button>
                    </div>
                </div>

                <div class="glass-card p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="table-header">
                                    <th class="p-4">Number</th>
                                    <th class="p-4">Date</th>
                                    <th class="p-4">Customer</th>
                                    <th class="p-4">Amount</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoice-history-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- CUSTOMERS PAGE -->
            <div id="customers" class="page hidden">
                <div
                    class="flex justify-between items-center mb-8"
                >
                    <div>
                        <h2 class="text-3xl font-bold">Customer Management</h2>
                        <p class="text-muted">Add and manage your customers</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 glass-card p-8">
                        <h3 class="text-xl font-bold mb-6">Add New Customer</h3>
                        <form id="add-customer-form" class="space-y-4">
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Company Name</label
                                >
                                <input
                                    name="Customer Name"
                                    type="text"
                                    class="futuristic-input"
                                    required
                                    autocomplete="off"
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Address</label
                                >
                                <textarea
                                    name="Address"
                                    rows="3"
                                    class="futuristic-textarea"
                                    required
                                    autocomplete="off"
                                ></textarea>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Contact Number</label
                                >
                                <input
                                    name="contact"
                                    type="text"
                                    class="futuristic-input"
                                    required
                                    autocomplete="off"
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >GSTIN</label
                                >
                                <input
                                    name="Customer GSTIN"
                                    type="text"
                                    class="futuristic-input"
                                    required
                                    autocomplete="off"
                                />
                            </div>
                            <button
                                type="submit"
                                class="w-full futuristic-btn futuristic-btn-secondary font-bold py-3 mt-4"
                            >
                                Add Customer
                            </button>
                        </form>
                    </div>
                    <div class="lg:col-span-2 glass-card p-8">
                        <h3 class="text-xl font-bold mb-6">Existing Customers</h3>
                        <div
                            id="existing-customers-list"
                            class="space-y-4 max-h-[60vh] overflow-y-auto pr-4"
                        ></div>
                    </div>
                </div>
            </div>

            <!-- PRODUCTS PAGE -->
            <div id="products" class="page hidden">
                <div
                    class="flex justify-between items-center mb-8"
                >
                    <div>
                        <h2 class="text-3xl font-bold">Inventory Management</h2>
                        <p class="text-muted">Add and manage your products</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 glass-card p-8">
                        <h3 class="text-xl font-bold mb-6">Add New Product</h3>
                        <form id="add-product-form" class="space-y-4" autocomplete="off">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >Model</label
                                    >
                                    <input
                                        name="MODEL"
                                        type="text"
                                        class="futuristic-input"
                                        required
                                        autocomplete="off"
                                    />
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >Model Number</label
                                    >
                                    <input
                                        name="MODEL NUMBER"
                                        type="text"
                                        class="futuristic-input"
                                        autocomplete="off"
                                    />
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Device</label
                                >
                                <input
                                    name="DEVICE"
                                    type="text"
                                    class="futuristic-input"
                                    autocomplete="off"
                                />
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >Size</label
                                    >
                                    <input
                                        name="SIZE"
                                        type="text"
                                        class="futuristic-input"
                                        autocomplete="off"
                                    />
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-medium text-muted mb-2"
                                        >HSN/SAC</label
                                    >
                                    <input
                                        name="HSN/SAC"
                                        type="text"
                                        value="8413"
                                        class="futuristic-input"
                                        required
                                        autocomplete="off"
                                    />
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Item Name</label
                                >
                                <input
                                    name="ITEM NAME"
                                    type="text"
                                    class="futuristic-input"
                                    required
                                    autocomplete="off"
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Price (₹)</label
                                >
                                <input
                                    name="PRICE"
                                    type="number"
                                    value="0"
                                    class="futuristic-input"
                                    required
                                    autocomplete="off"
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Availability</label
                                >
                                <select
                                    name="AVAILABILITY"
                                    class="futuristic-select"
                                    autocomplete="off"
                                >
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <button
                                type="submit"
                                class="w-full futuristic-btn futuristic-btn-secondary font-bold py-3 mt-4"
                            >
                                Add Product
                            </button>
                        </form>
                    </div>
                    <div class="lg:col-span-2 glass-card p-8">
                        <h3 class="text-xl font-bold mb-6">Existing Products</h3>
                        <div
                            id="existing-products-list"
                            class="space-y-4 max-h-[60vh] overflow-y-auto pr-4"
                        ></div>
                    </div>
                </div>
            </div>

            <!-- REPORTS PAGE -->
            <div id="reports" class="page hidden">
                <div
                    class="flex justify-between items-center mb-8"
                >
                    <div>
                        <h2 class="text-3xl font-bold">Reports & Analytics</h2>
                        <p class="text-muted">GST returns and business insights</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold mb-6">GSTR-1 Summary</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-muted">B2B Supplies</span>
                                <span id="gstr1-b2b">₹0</span>
                            </div>
                            <div
                                class="flex justify-between font-bold border-t pt-2 mt-2 border-white/10"
                            >
                                <span>Total Output Tax</span>
                                <span id="gstr1-total">₹0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS PAGE -->
            <div id="settings" class="page hidden">
                <div
                    class="flex justify-between items-center mb-8"
                >
                    <div>
                        <h2 class="text-3xl font-bold">Settings</h2>
                        <p class="text-muted">Manage application settings</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="glass-card p-8">
                        <h3 class="text-xl font-bold mb-6">Invoice Settings</h3>
                        <form id="invoice-settings-form" class="space-y-4" autocomplete="off">
                            <div>
                                <label
                                    for="invoice-prefix"
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Invoice Prefix</label
                                >
                                <input
                                    id="invoice-prefix"
                                    type="text"
                                    class="futuristic-input"
                                    placeholder="e.g. INV"
                                    autocomplete="off"
                                />
                            </div>
                            <div>
                                <label
                                    for="invoice-start-number"
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Start Number</label
                                >
                                <input
                                    id="invoice-start-number"
                                    type="number"
                                    class="futuristic-input"
                                    placeholder="1000"
                                    min="1"
                                    autocomplete="off"
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-muted mb-2"
                                    >Auto Increment Invoice Number</label
                                >
                                <select id="auto-increment-toggle" class="futuristic-select">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                            <button
                                type="submit"
                                class="w-full futuristic-btn futuristic-btn-secondary font-bold py-3 mt-4"
                            >
                                Save Settings
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer class="fixed-footer no-print">
        <button id="download-pdf" class="futuristic-btn futuristic-btn-secondary px-6 py-2">
            <i data-lucide="download" class="w-5 h-5"></i><span>Download PDF</span>
        </button>
        <button id="print-invoice" class="futuristic-btn futuristic-btn-neutral px-6 py-2">
            <i data-lucide="printer" class="w-5 h-5"></i><span>Print</span>
        </button>
        <button id="save-invoice" class="futuristic-btn futuristic-btn" style="background: linear-gradient(135deg, #10b981 0%, #047857 100%)">
            <i data-lucide="save" class="w-5 h-5"></i><span>Save Invoice</span>
        </button>
    </footer>

<script>
(() => {
    'use strict';

    // ==== DATA STORAGE (In-memory as example; can connect to backend or Google Sheets)
    let customers = [];
    let products = [];
    let invoices = [];
    let settings = {
        invoicePrefix: 'INV',
        invoiceStartNumber: 1000,
        autoIncrement: true,
    };

    // ==== UTILITIES
    function $(selector, parent = document) {
        return parent.querySelector(selector);
    }
    function $all(selector, parent = document) {
        return [...parent.querySelectorAll(selector)];
    }
    function formatDate(date) {
        return date.toISOString().slice(0, 10);
    }
    function parseCurrency(val) {
        return parseFloat(val) || 0;
    }
    function generateInvoiceNumber() {
        if (settings.autoIncrement) {
            const lastInvoice = invoices.length > 0 ? invoices[invoices.length - 1] : null;
            if (lastInvoice) {
                const lastNum = parseInt(lastInvoice.number.replace(settings.invoicePrefix, ''), 10);
                return settings.invoicePrefix + (lastNum + 1);
            } else {
                return settings.invoicePrefix + settings.invoiceStartNumber;
            }
        } else {
            return settings.invoicePrefix + settings.invoiceStartNumber;
        }
    }

    // ==== DOM ELEMENTS
    const navLinks = $all('.nav-item');
    const pages = $all('.page');

    // ==== NAVIGATION
    function switchPage(hash) {
        const targetId = hash.replace('#', '') || 'dashboard';
        pages.forEach((page) => {
            page.classList.toggle('hidden', page.id !== targetId);
        });
        navLinks.forEach((link) => {
            link.classList.toggle('active', link.getAttribute('href') === '#' + targetId);
        });

        if (targetId === 'create-invoice') {
            resetInvoiceForm();
            populateCustomerSelect();
            populateProductSelect();
        } else if (targetId === 'dashboard') {
            updateDashboardStats();
        } else if (targetId === 'invoice-history') {
            renderInvoiceHistory();
        } else if (targetId === 'customers') {
            renderCustomerList();
        } else if (targetId === 'products') {
            renderProductList();
        } else if (targetId === 'settings') {
            loadSettingsForm();
        }
    }

    window.addEventListener('hashchange', () => {
        switchPage(location.hash);
    });

    navLinks.forEach((link) => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            location.hash = link.getAttribute('href');
        });
    });

    // ==== SETTINGS FORM
    function loadSettingsForm() {
        $('#invoice-prefix').value = settings.invoicePrefix;
        $('#invoice-start-number').value = settings.invoiceStartNumber;
        $('#auto-increment-toggle').value = settings.autoIncrement ? 'true' : 'false';
    }

    $('#invoice-settings-form').addEventListener('submit', (e) => {
        e.preventDefault();
        settings.invoicePrefix = $('#invoice-prefix').value.trim() || 'INV';
        const startNum = parseInt($('#invoice-start-number').value, 10);
        settings.invoiceStartNumber = !isNaN(startNum) && startNum > 0 ? startNum : 1000;
        settings.autoIncrement = $('#auto-increment-toggle').value === 'true';

        Swal.fire({
            icon: 'success',
            title: 'Settings Saved',
            timer: 1500,
            showConfirmButton: false,
        });

        refreshInvoiceNumber();
        updateDashboardStats();
    });

    // ==== CUSTOMER MANAGEMENT
    function renderCustomerList() {
        const container = $('#existing-customers-list');
        container.innerHTML = '';
        if (customers.length === 0) {
            container.innerHTML = `<p class="text-muted">No customers found. Add some!</p>`;
            return;
        }
        customers.forEach((c, i) => {
            const div = document.createElement('div');
            div.className =
                'glass-card p-4 flex justify-between items-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors rounded-md';
            div.innerHTML = `
                <div>
                    <h4 class="font-semibold">${c['Customer Name']}</h4>
                    <p class="text-sm text-muted">${c.Address}</p>
                </div>
                <div class="text-sm text-muted">${c['Customer GSTIN']}</div>
            `;
            container.appendChild(div);
        });
    }

    $('#add-customer-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const form = e.target;
        const newCustomer = {
            'Customer Name': form['Customer Name'].value.trim(),
            Address: form.Address.value.trim(),
            contact: form.contact.value.trim(),
            'Customer GSTIN': form['Customer GSTIN'].value.trim().toUpperCase(),
        };
        if (!newCustomer['Customer Name']) {
            Swal.fire('Error', 'Customer name is required', 'error');
            return;
        }
        customers.push(newCustomer);
        form.reset();
        renderCustomerList();
        Swal.fire('Success', 'Customer added successfully', 'success');
    });

    // ==== PRODUCT MANAGEMENT
    function renderProductList() {
        const container = $('#existing-products-list');
        container.innerHTML = '';
        if (products.length === 0) {
            container.innerHTML = `<p class="text-muted">No products found. Add some!</p>`;
            return;
        }
        products.forEach((p, i) => {
            const div = document.createElement('div');
            div.className =
                'glass-card p-4 flex justify-between items-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors rounded-md';
            div.innerHTML = `
                <div>
                    <h4 class="font-semibold">${p['ITEM NAME']}</h4>
                    <p class="text-sm text-muted">Model: ${p.MODEL} | Device: ${p.DEVICE}</p>
                </div>
                <div class="text-sm text-muted">₹${p.PRICE}</div>
            `;
            container.appendChild(div);
        });
    }

    $('#add-product-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const form = e.target;
        const newProduct = {
            MODEL: form.MODEL.value.trim(),
            'MODEL NUMBER': form['MODEL NUMBER'].value.trim(),
            DEVICE: form.DEVICE.value.trim(),
            SIZE: form.SIZE.value.trim(),
            'HSN/SAC': form['HSN/SAC'].value.trim(),
            'ITEM NAME': form['ITEM NAME'].value.trim(),
            PRICE: parseFloat(form.PRICE.value) || 0,
            AVAILABILITY: form.AVAILABILITY.value,
        };
        if (!newProduct['ITEM NAME'] || newProduct.PRICE <= 0) {
            Swal.fire('Error', 'Product name and price must be valid', 'error');
            return;
        }
        products.push(newProduct);
        form.reset();
        renderProductList();
        Swal.fire('Success', 'Product added successfully', 'success');
    });

    // ==== CUSTOMER SELECT IN INVOICE FORM
    function populateCustomerSelect() {
        const select = $('#customer-select');
        select.innerHTML = '<option value="">Select Customer</option>';
        customers.forEach((c, i) => {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = c['Customer Name'];
            select.appendChild(option);
        });
    }

    // ==== PRODUCT SELECT IN INVOICE ITEM
    function createInvoiceItemElement(index) {
        const div = document.createElement('div');
        div.className = 'invoice-item glass-card p-4 relative';
        div.dataset.index = index;

        div.innerHTML = `
            <div class="grid grid-cols-12 gap-2">
                <div class="col-span-4">
                    <label class="block text-sm font-medium mb-1">Item</label>
                    <select class="futuristic-select invoice-item-name" required>
                        <option value="">Select Item</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium mb-1">Model</label>
                    <input type="text" class="futuristic-input invoice-item-model" readonly />
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium mb-1">Device</label>
                    <input type="text" class="futuristic-input invoice-item-device" readonly />
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium mb-1">Price (₹)</label>
                    <input type="number" min="0" class="futuristic-input invoice-item-price" readonly />
                </div>
                <div class="col-span-1">
                    <label class="block text-sm font-medium mb-1">Qty</label>
                    <input type="number" min="1" class="futuristic-input invoice-item-qty" value="1" required />
                </div>
                <div class="col-span-1 flex items-center justify-end">
                    <button class="remove-item-btn text-red-500 hover:text-red-700" title="Remove Item" type="button">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        `;

        // Populate product options
        const itemSelect = div.querySelector('.invoice-item-name');
        itemSelect.innerHTML = '<option value="">Select Item</option>';
        products.forEach((p, i) => {
            const opt = document.createElement('option');
            opt.value = i;
            opt.textContent = p['ITEM NAME'];
            itemSelect.appendChild(opt);
        });

        // Event handlers
        itemSelect.addEventListener('change', (e) => {
            const idx = parseInt(e.target.value);
            if (!isNaN(idx) && products[idx]) {
                const product = products[idx];
                div.querySelector('.invoice-item-model').value = product.MODEL;
                div.querySelector('.invoice-item-device').value = product.DEVICE;
                div.querySelector('.invoice-item-price').value = product.PRICE;
                div.querySelector('.invoice-item-qty').value = 1;
                updateInvoicePreview();
            } else {
                div.querySelector('.invoice-item-model').value = '';
                div.querySelector('.invoice-item-device').value = '';
                div.querySelector('.invoice-item-price').value = '';
                div.querySelector('.invoice-item-qty').value = 1;
                updateInvoicePreview();
            }
        });

        div.querySelector('.invoice-item-qty').addEventListener('input', () => {
            updateInvoicePreview();
        });

        div.querySelector('.remove-item-btn').addEventListener('click', () => {
            div.remove();
            updateInvoicePreview();
        });

        return div;
    }

    // Add new invoice item block
    function addInvoiceItem() {
        const container = $('#invoice-items-container');
        const itemCount = container.children.length;
        container.appendChild(createInvoiceItemElement(itemCount));
    }

    // ==== INVOICE FORM HANDLING ====

    function refreshInvoiceNumber() {
        $('#invoice-number').value = generateInvoiceNumber();
    }

    $('#customer-select').addEventListener('change', (e) => {
        const idx = e.target.value;
        if (idx === '' || isNaN(idx)) {
            $('#customer-gstin-display').value = '';
            $('#place-of-supply-display').value = '';
            return;
        }
        const customer = customers[idx];
        $('#customer-gstin-display').value = customer['Customer GSTIN'];
        // Place of Supply: using first two chars of GSTIN or can customize
        if (customer['Customer GSTIN'].length >= 2) {
            $('#place-of-supply-display').value = customer['Customer GSTIN'].slice(0, 2);
        } else {
            $('#place-of-supply-display').value = '';
        }
    });

    // Clear the invoice form completely
    function resetInvoiceForm() {
        $('#invoice-form').reset();
        $('#invoice-items-container').innerHTML = '';
        refreshInvoiceNumber();
        $('#customer-gstin-display').value = '';
        $('#place-of-supply-display').value = '';
        $('#invoice-preview').innerHTML = `<div class="flex flex-col justify-center items-center text-center text-muted h-full p-6">
            <i data-lucide="file-text" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
            <p>Invoice preview will appear here</p>
            <p class="text-sm">Fill in the invoice details to see the live preview</p>
        </div>`;
    }

    // Generate invoice preview HTML
    function generateInvoicePreview() {
        const form = $('#invoice-form');
        const invoiceNumber = $('#invoice-number').value;
        const invoiceDate = $('#invoice-date').value;
        const customerIndex = $('#customer-select').value;
        if (customerIndex === '' || !customers[customerIndex]) {
            return `<p class="text-muted p-6">Please select a valid customer to preview invoice.</p>`;
        }
        const customer = customers[customerIndex];
        const dispatch = $('#dispatch-method').value;
        const ewayBill = $('#eway-bill-number').value.trim();

        const items = [];
        $('#invoice-items-container')
            .querySelectorAll('.invoice-item')
            .forEach((itemDiv) => {
                const idx = parseInt(itemDiv.dataset.index);
                const itemSelect = itemDiv.querySelector('.invoice-item-name');
                if (!itemSelect.value) return; // skip if no item selected
                const product = products[itemSelect.value];
                if (!product) return;
                const qty = parseInt(itemDiv.querySelector('.invoice-item-qty').value) || 1;
                const price = parseFloat(product.PRICE) || 0;
                items.push({
                    name: product['ITEM NAME'],
                    model: product.MODEL,
                    device: product.DEVICE,
                    price: price,
                    qty: qty,
                    total: price * qty,
                });
            });

        if (items.length === 0) {
            return `<p class="text-muted p-6">Add at least one invoice item to preview.</p>`;
        }

        let subtotal = 0;
        items.forEach((it) => {
            subtotal += it.total;
        });

        // Simplified GST calculations for demo
        const gstRate = 0.18; // 18%
        const gstAmount = subtotal * gstRate;
        const totalAmount = subtotal + gstAmount;

        // Build HTML preview string
        let html = `
            <div class="p-6 invoice-preview">
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold mb-1">VINAYAKA INDUSTRIES</h1>
                        <p class="text-sm">GSTIN: 21AQCPK0903A1ZI</p>
                        <p class="text-sm mt-2">Bank: HDFC BANK, Mathikere Branch</p>
                        <p class="text-sm">A/C: 123456789901 | IFSC: HDFC00009</p>
                    </div>
                    <div class="text-right">
                        <h2 class="text-xl font-semibold">Invoice</h2>
                        <p>Number: <strong>${invoiceNumber}</strong></p>
                        <p>Date: <strong>${invoiceDate}</strong></p>
                    </div>
                </div>

                <div class="mb-8 grid grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold mb-2">Bill To:</h3>
                        <p>${customer['Customer Name']}</p>
                        <p>${customer.Address}</p>
                        <p>GSTIN: ${customer['Customer GSTIN']}</p>
                    </div>
                    <div>
                        <h3 class="font-semibold mb-2">Dispatch Details:</h3>
                        <p>Place of Supply: ${$('#place-of-supply-display').value}</p>
                        <p>Dispatch Method: ${dispatch}</p>
                        <p>Eway Bill: ${ewayBill || 'N/A'}</p>
                    </div>
                </div>

                <table class="w-full border-collapse border border-gray-300 mb-6">
                    <thead>
                        <tr class="bg-gray-200 dark:bg-gray-700">
                            <th class="border border-gray-300 px-3 py-2">Item</th>
                            <th class="border border-gray-300 px-3 py-2">Model</th>
                            <th class="border border-gray-300 px-3 py-2">Device</th>
                            <th class="border border-gray-300 px-3 py-2">Price (₹)</th>
                            <th class="border border-gray-300 px-3 py-2">Qty</th>
                            <th class="border border-gray-300 px-3 py-2">Total (₹)</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        items.forEach((it) => {
            html += `
                <tr>
                    <td class="border border-gray-300 px-3 py-1">${it.name}</td>
                    <td class="border border-gray-300 px-3 py-1">${it.model}</td>
                    <td class="border border-gray-300 px-3 py-1">${it.device}</td>
                    <td class="border border-gray-300 px-3 py-1 text-right">${it.price.toFixed(2)}</td>
                    <td class="border border-gray-300 px-3 py-1 text-center">${it.qty}</td>
                    <td class="border border-gray-300 px-3 py-1 text-right">${it.total.toFixed(2)}</td>
                </tr>
            `;
        });

        html += `
                    </tbody>
                </table>

                <div class="text-right space-y-1 text-lg">
                    <p>Subtotal: ₹${subtotal.toFixed(2)}</p>
                    <p>GST @18%: ₹${gstAmount.toFixed(2)}</p>
                    <p class="font-bold text-xl">Total: ₹${totalAmount.toFixed(2)}</p>
                </div>

                <div class="mt-12 text-center text-xs text-muted">
                    <p>Thank you for your business!</p>
                    <p>VINAYAKA INDUSTRIES &copy; ${new Date().getFullYear()}</p>
                </div>
            </div>
        `;

        return html;
    }

    function updateInvoicePreview() {
        const previewContainer = $('#invoice-preview');
        previewContainer.innerHTML = generateInvoicePreview();
        lucide.replace();
    }

    // ==== SAVE INVOICE
    $('#save-invoice').addEventListener('click', () => {
        const invoiceNumber = $('#invoice-number').value.trim();
        if (!invoiceNumber) {
            Swal.fire('Error', 'Invoice Number is required', 'error');
            return;
        }
        const invoiceDate = $('#invoice-date').value;
        if (!invoiceDate) {
            Swal.fire('Error', 'Invoice Date is required', 'error');
            return;
        }
        const customerIndex = $('#customer-select').value;
        if (customerIndex === '' || !customers[customerIndex]) {
            Swal.fire('Error', 'Please select a valid customer', 'error');
            return;
        }

        const items = [];
        $('#invoice-items-container')
            .querySelectorAll('.invoice-item')
            .forEach((itemDiv) => {
                const itemSelect = itemDiv.querySelector('.invoice-item-name');
                if (!itemSelect.value) return;
                const product = products[itemSelect.value];
                if (!product) return;
                const qty = parseInt(itemDiv.querySelector('.invoice-item-qty').value) || 1;
                const price = parseFloat(product.PRICE) || 0;
                items.push({
                    name: product['ITEM NAME'],
                    model: product.MODEL,
                    device: product.DEVICE,
                    price: price,
                    qty: qty,
                    total: price * qty,
                });
            });
        if (items.length === 0) {
            Swal.fire('Error', 'Please add at least one item', 'error');
            return;
        }

        const invoice = {
            number: invoiceNumber,
            date: invoiceDate,
            customer: customers[customerIndex],
            items,
            dispatch: $('#dispatch-method').value,
            ewayBill: $('#eway-bill-number').value.trim(),
        };

        invoices.push(invoice);

        Swal.fire({
            icon: 'success',
            title: 'Invoice saved successfully',
            timer: 2000,
            showConfirmButton: false,
        });

        updateDashboardStats();
        resetInvoiceForm();
        location.hash = '#invoice-history';
    });

    // ==== INVOICE HISTORY TABLE
    function renderInvoiceHistory() {
        const tbody = $('#invoice-history-table');
        tbody.innerHTML = '';
        if (invoices.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted py-4">No invoices saved yet.</td></tr>`;
            return;
        }
        invoices.forEach((inv, i) => {
            const tr = document.createElement('tr');
            tr.className = 'table-row';
            tr.innerHTML = `
                <td class="p-4">${inv.number}</td>
                <td class="p-4">${inv.date}</td>
                <td class="p-4">${inv.customer['Customer Name']}</td>
                <td class="p-4">₹${inv.items.reduce((a, c) => a + c.total, 0).toFixed(2)}</td>
                <td class="p-4">Saved</td>
                <td class="p-4">
                    <button data-index="${i}" class="btn-view-invoice futuristic-btn px-3 py-1 text-xs">
                        View
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        });

        $all('.btn-view-invoice').forEach((btn) => {
            btn.addEventListener('click', (e) => {
                const idx = e.target.dataset.index;
                if (idx !== undefined) {
                    showInvoiceDetails(invoices[idx]);
                }
            });
        });
    }

    // Show invoice details modal or alert
    function showInvoiceDetails(inv) {
        let html = `
            <h3 class="text-xl font-bold mb-4">Invoice Details - ${inv.number}</h3>
            <p><strong>Date:</strong> ${inv.date}</p>
            <p><strong>Customer:</strong> ${inv.customer['Customer Name']}</p>
            <p><strong>GSTIN:</strong> ${inv.customer['Customer GSTIN']}</p>
            <table class="w-full mt-4 border-collapse border border-gray-300">
                <thead>
                    <tr class="bg-gray-200 dark:bg-gray-700">
                        <th class="border border-gray-300 px-2 py-1">Item</th>
                        <th class="border border-gray-300 px-2 py-1">Model</th>
                        <th class="border border-gray-300 px-2 py-1">Device</th>
                        <th class="border border-gray-300 px-2 py-1 text-right">Price</th>
                        <th class="border border-gray-300 px-2 py-1 text-center">Qty</th>
                        <th class="border border-gray-300 px-2 py-1 text-right">Total</th>
                    </tr>
                </thead>
                <tbody>
        `;
        let subtotal = 0;
        inv.items.forEach((it) => {
            subtotal += it.total;
            html += `
                <tr>
                    <td class="border border-gray-300 px-2 py-1">${it.name}</td>
                    <td class="border border-gray-300 px-2 py-1">${it.model}</td>
                    <td class="border border-gray-300 px-2 py-1">${it.device}</td>
                    <td class="border border-gray-300 px-2 py-1 text-right">₹${it.price.toFixed(2)}</td>
                    <td class="border border-gray-300 px-2 py-1 text-center">${it.qty}</td>
                    <td class="border border-gray-300 px-2 py-1 text-right">₹${it.total.toFixed(2)}</td>
                </tr>
            `;
        });
        const gstAmount = subtotal * 0.18;
        const totalAmount = subtotal + gstAmount;

        html += `
                </tbody>
            </table>
            <div class="mt-4 text-right">
                <p>Subtotal: ₹${subtotal.toFixed(2)}</p>
                <p>GST @18%: ₹${gstAmount.toFixed(2)}</p>
                <p class="font-bold text-lg">Total: ₹${totalAmount.toFixed(2)}</p>
            </div>
        `;

        Swal.fire({
            title: `Invoice ${inv.number}`,
            html,
            width: '700px',
            showCloseButton: true,
            showConfirmButton: false,
            didOpen: () => {
                lucide.replace();
            },
        });
    }

    // ==== DASHBOARD STATS
    function updateDashboardStats() {
        $('#stats-total-invoices').textContent = invoices.length;
        let totalRevenue = 0;
        invoices.forEach((inv) => {
            totalRevenue += inv.items.reduce((a, c) => a + c.total, 0);
        });
        $('#stats-revenue').textContent = '₹' + totalRevenue.toFixed(2);
        $('#stats-active-customers').textContent = customers.length;
        $('#stats-products').textContent = products.length;
    }

    // ==== THEME TOGGLE
    const themeToggle = $('#theme-toggle');
    const themeIcon = $('#theme-icon');

    function setTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.remove('light-theme');
            document.body.classList.add('dark-theme');
            themeIcon.setAttribute('data-lucide', 'sun');
        } else {
            document.body.classList.remove('dark-theme');
            document.body.classList.add('light-theme');
            themeIcon.setAttribute('data-lucide', 'moon');
        }
        lucide.replace();
        localStorage.setItem('theme', theme);
    }

    themeToggle.addEventListener('click', () => {
        if (document.body.classList.contains('dark-theme')) {
            setTheme('light');
        } else {
            setTheme('dark');
        }
    });

    // Initialize theme from localStorage or default to dark
    const savedTheme = localStorage.getItem('theme') || 'dark';
    setTheme(savedTheme);

    // ==== INVOICE DATE DEFAULT TO TODAY
    function setInvoiceDateToday() {
        const today = new Date();
        $('#invoice-date').value = formatDate(today);
    }

    // ==== DOWNLOAD PDF
    $('#download-pdf').addEventListener('click', () => {
        const preview = $('#invoice-preview');
        if (!preview.innerHTML.trim() || preview.textContent.includes('Invoice preview will appear here')) {
            Swal.fire('Error', 'Please create and preview an invoice first', 'error');
            return;
        }
        html2pdf().from(preview).set({
            margin: 0.5,
            filename: `Invoice-${$('#invoice-number').value}.pdf`,
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
        }).save();
    });

    // ==== PRINT INVOICE
    $('#print-invoice').addEventListener('click', () => {
        const preview = $('#invoice-preview');
        if (!preview.innerHTML.trim() || preview.textContent.includes('Invoice preview will appear here')) {
            Swal.fire('Error', 'Please create and preview an invoice first', 'error');
            return;
        }
        const printWindow = window.open('', '', 'width=900,height=650');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Print Invoice</title>
                    <style>
                        body { font-family: 'Inter', sans-serif; padding: 20px; }
                        table { border-collapse: collapse; width: 100%; }
                        th, td { border: 1px solid #333; padding: 8px; }
                        th { background-color: #f0f0f0; }
                        h1,h2,h3 { margin-bottom: 0.5rem; }
                    </style>
                </head>
                <body>
                    ${preview.innerHTML}
                </body>
            </html>`);
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => {
            printWindow.print();
            printWindow.close();
        }, 500);
    });

    // ==== SYNC DATA BUTTON (stub)
    window.syncData = () => {
        Swal.fire('Info', 'Sync feature not implemented yet', 'info');
    };

    // ==== INITIAL SETUP
    function init() {
        switchPage(location.hash);
        refreshInvoiceNumber();
        setInvoiceDateToday();
        lucide.replace();
    }

    // Monitor invoice form changes to update preview live
    $('#invoice-form').addEventListener('input', updateInvoicePreview);
    $('#invoice-items-container').addEventListener('input', updateInvoicePreview);
    $('#dispatch-method').addEventListener('change', updateInvoicePreview);
    $('#eway-bill-number').addEventListener('input', updateInvoicePreview);

    init();

})();
</script>
</body>
</html>
